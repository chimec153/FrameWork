#include "StaticObj.h"
#include "../Collider/ColliderRect.h"
#include "../Core/Input.h"
#include "../Scene/SceneManager.h"
#include "../Scene/Scene.h"
#include "Tile.h"
#include "Stage.h"

StaticObj::StaticObj()
{
}

StaticObj::StaticObj(const StaticObj & obj)	:
	Obj(obj)
{
	AddCollisionFunc();
}

StaticObj::~StaticObj()
{
}

void StaticObj::Input(float fDeltaTime)
{
	Obj::Input(fDeltaTime);
}

int StaticObj::Update(float fDeltaTime)
{
	Obj::Update(fDeltaTime);
	return 0;
}

int StaticObj::LateUpdate(float fDeltaTime)
{
	Obj::LateUpdate(fDeltaTime);
	return 0;
}

void StaticObj::Collision(float fDeltaTime)
{
	Obj::Collision(fDeltaTime);
}

void StaticObj::Render(HDC hDC, float fDeltaTime)
{
	Obj::Render(hDC, fDeltaTime);
}

void StaticObj::Save(FILE * pFile)
{
	Obj::Save(pFile);
}
void StaticObj::Load(FILE * pFile)
{
	Obj::Load(pFile);

	AddCollisionFunc();
}

void StaticObj::AddCollisionFunc()
{
	ColliderRect* pRC = (ColliderRect*)GetCollider("StaticObjBody");

	if (pRC)
	{
		pRC->AddCollisionFunction(CS_ENTER, this,
			&StaticObj::Hit);
		pRC->AddCollisionFunction(CS_STAY, this,
			&StaticObj::HitStay);

		SAFE_RELEASE(pRC);
	}
}

void StaticObj::Hit(Collider* pSrc, Collider* pDest, float fDeltaTime)
{
	if (pDest->GetTag() == "Mouse")
	{
		if (KEYPRESS("MouseRButton"))
		{
			bool bEdit = GET_SINGLE(SceneManager)->GetScene()->IsEditMode();

			if (bEdit)
			{
				Tile* pTile = m_pScene->GetStage()->GetTile(m_tPos);

				pTile->SetTileOption(TO_NONE);
				pTile->DeleteObj();

				Die();
			}
		}
	}
}

void StaticObj::HitStay(Collider* pSrc, Collider* pDest, float fDeltaTime)
{
	if (pDest->GetTag() == "Mouse")
	{
		if (KEYPRESS("MouseRButton"))
		{
			bool bEdit = GET_SINGLE(SceneManager)->GetScene()->IsEditMode();

			if (bEdit)
			{
				Tile* pTile = m_pScene->GetStage()->GetTile(m_tPos);

				pTile->SetTileOption(TO_NONE);
				pTile->DeleteObj();

				Die();
			}
		}
	}
}