#include "AniEditDlg.h"
#include "Core.h"
#include "Core/PathManager.h"
#include "Scene/AnimationEditScene.h"

CAniEditDlg* g_pDlg = nullptr;

CAniEditDlg::CAniEditDlg()	:
	m_hWnd(0),
	m_pAnimation(nullptr)
{
	g_pDlg = this;
}

CAniEditDlg::~CAniEditDlg()
{
}

void CAniEditDlg::OnEditDlg(int iID)
{
	m_hWnd = CreateDialog(WINDOWINSTANCE, MAKEINTRESOURCE(iID), WINDOWHANDLE, CAniEditDlg::DlgProc);
	ShowWindow(m_hWnd, SW_SHOW);

	ShowCursor(true);
}

void CAniEditDlg::Clear()
{
	DestroyWindow(m_hWnd);

	g_pDlg = 0;

	ShowCursor(false);
}

void CAniEditDlg::Save()
{
}

void CAniEditDlg::Load()
{
}

void CAniEditDlg::LoadTexture()
{
	OPENFILENAME tOFN = {};

	TCHAR strFile[MAX_PATH] = {};

	tOFN.hInstance = WINDOWINSTANCE;
	tOFN.hwndOwner = m_hWnd;
	tOFN.lpstrFile = strFile;
	tOFN.lpstrFilter = TEXT("모든파일\0*.*\0비트맵파일\0*.bmp");
	tOFN.lpstrInitialDir = GET_SINGLE(PathManager)->FindPath(TEXTURE_PATH);
	tOFN.lStructSize = sizeof(OPENFILENAME);
	tOFN.nMaxFile = 256;
	
	if (GetOpenFileName(&tOFN))
		LoadTexture(strFile);
}

void CAniEditDlg::Save(const TCHAR* pFileName)
{
}

void CAniEditDlg::LoadTexture(const TCHAR* pFileName)
{
	char strFullPath[MAX_PATH] = {};

#ifdef _UNICODE
	WideCharToMultiByte(CP_ACP, NULL, pFileName, -1, strFullPath, lstrlen(pFileName), NULL, NULL);
#else
	strcpy_s(strFullPath, pFileName);
#endif


}


INT_PTR __stdcall CAniEditDlg::DlgProc(HWND hWnd, UINT iMessage, WPARAM wParam, LPARAM lParam)
{
	switch (iMessage)
	{
	case WM_INITDIALOG:
		g_pDlg->m_hWnd = hWnd;
		break;
	case WM_COMMAND:
		switch (LOWORD(wParam))
		{
		case IDOK:
			DestroyWindow(hWnd);
			break;
		case ID_TEXTURE_LOAD:
			break;
		case IDC_BUTTON_ANI_SAVE:
			g_pDlg->Save();
			break;
		}
		break;
	case WM_CLOSE:
		DestroyWindow(hWnd);
		break;
	case WM_DESTROY:
		PostQuitMessage(0);
		break;
	}

	return INT_PTR();
}
